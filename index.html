<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Admin Dashboard | Direct Access</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: #f4f7f6; padding: 40px; }
        header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        .logo-text { font-weight: 800; font-size: 1.5rem; color: #000; }
        
        .pending-item { 
            background: white; padding: 20px; border-radius: 15px; 
            margin-bottom: 10px; display: flex; justify-content: space-between; 
            align-items: center; border: 1px solid #eee; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.02);
        }

        .actions { display: flex; gap: 10px; }
        
        .btn { border: none; padding: 10px 18px; border-radius: 8px; cursor: pointer; font-weight: 600; transition: 0.2s; }
        .approve-btn { background: #10b981; color: white; }
        .approve-btn:hover { background: #059669; }
        
        .reject-btn { background: #fee2e2; color: #ef4444; }
        .reject-btn:hover { background: #fecaca; }

        #list { min-height: 200px; }
        .empty-msg { text-align: center; color: #666; margin-top: 50px; }
    </style>
</head>
<body>

    <header>
        <div>
            <div class="logo-text">App Hub Admin</div>
            <p style="margin: 5px 0 0 0; color: #666;">Direct Management Mode</p>
        </div>
        <button onclick="location.href='index.html'" style="background:black; color:white; border:none; padding:10px 20px; border-radius:8px; cursor:pointer; font-weight:600;">View Live Store</button>
    </header>

    <hr style="border: 0; border-top: 1px solid #eee; margin-bottom: 30px;">

    <div id="list">Loading submissions...</div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, onValue, update, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyD_lFs83fyT6pNcNECGueOYJeedGVKY7GA",
            authDomain: "homieclothing-da3f7.firebaseapp.com",
            databaseURL: "https://homieclothing-da3f7-default-rtdb.firebaseio.com",
            projectId: "homieclothing-da3f7",
            storageBucket: "homieclothing-da3f7.appspot.com",
            messagingSenderId: "1051904277079",
            appId: "1:1051904277079:web:8166b47b1a1407e2fe0112"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // Core logic starts immediately
        function fetchSubmissions() {
            onValue(ref(db, 'apps'), (snapshot) => {
                const list = document.getElementById('list');
                list.innerHTML = "";
                const data = snapshot.val();
                
                if(!data) { 
                    list.innerHTML = "<div class='empty-msg'>No apps found in database.</div>"; 
                    return; 
                }

                let pendingCount = 0;
                Object.keys(data).forEach(id => {
                    // We only show apps that haven't been confirmed yet
                    if(data[id].isConfirmed === false) {
                        pendingCount++;
                        const div = document.createElement('div');
                        div.className = 'pending-item';
                        div.innerHTML = `
                            <div>
                                <strong style="font-size: 1.1rem;">${data[id].name}</strong><br>
                                <small style="color: #888;">Source: ${data[id].downloadUrl}</small>
                            </div>
                            <div class="actions">
                                <button class="btn reject-btn" onclick="rejectApp('${id}')">Delete</button>
                                <button class="btn approve-btn" onclick="approveApp('${id}')">Confirm & Publish</button>
                            </div>
                        `;
                        list.appendChild(div);
                    }
                });

                if(pendingCount === 0) {
                    list.innerHTML = "<div class='empty-msg'>âœ¨ All apps are reviewed! No new submissions.</div>";
                }
            });
        }

        // Global functions for buttons
        window.approveApp = (id) => {
            update(ref(db, 'apps/' + id), { isConfirmed: true })
            .catch(err => alert("Error: " + err.message));
        };

        window.rejectApp = (id) => {
            if(confirm("Permanently delete this submission?")) {
                remove(ref(db, 'apps/' + id))
                .catch(err => alert("Error: " + err.message));
            }
        };

        // Initialize
        fetchSubmissions();
    </script>
</body>
</html>
