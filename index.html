<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Control Panel</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        :root { --green: #10b981; --red: #ef4444; --bg: #f9fafb; }
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: var(--bg); margin: 0; padding: 40px; }
        
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 40px; }
        h2 { margin-top: 40px; border-bottom: 2px solid #eee; padding-bottom: 10px; }
        
        .card { 
            background: white; padding: 20px; border-radius: 16px; 
            margin-bottom: 12px; display: flex; justify-content: space-between; 
            align-items: center; box-shadow: 0 2px 4px rgba(0,0,0,0.04);
            border: 1px solid #eee;
        }

        .info strong { font-size: 1.1rem; display: block; }
        .info small { color: #666; }

        .btns { display: flex; gap: 8px; }
        button { 
            border: none; padding: 10px 16px; border-radius: 10px; 
            font-weight: 600; cursor: pointer; transition: 0.2s; 
        }

        .btn-approve { background: var(--green); color: white; }
        .btn-delete { background: #fee2e2; color: var(--red); }
        .btn-store { background: #000; color: white; text-decoration: none; padding: 10px 20px; border-radius: 10px; font-size: 0.9rem; }
        
        .status-tag { 
            font-size: 0.7rem; padding: 4px 8px; border-radius: 6px; 
            text-transform: uppercase; font-weight: 800; margin-bottom: 5px; display: inline-block;
        }
        .tag-pending { background: #fef3c7; color: #92400e; }
        .tag-live { background: #d1fae5; color: #065f46; }
    </style>
</head>
<body>

    <div class="header">
        <h1>Admin Control Panel</h1>
        <a href="index.html" class="btn-store">← Back to App Store</a>
    </div>

    <h2>Pending Submissions</h2>
    <div id="pending-list">Loading...</div>

    <h2>Live Apps</h2>
    <div id="live-list">Loading...</div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, onValue, update, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyD_lFs83fyT6pNcNECGueOYJeedGVKY7GA",
            authDomain: "homieclothing-da3f7.firebaseapp.com",
            databaseURL: "https://homieclothing-da3f7-default-rtdb.firebaseio.com",
            projectId: "homieclothing-da3f7",
            storageBucket: "homieclothing-da3f7.appspot.com",
            messagingSenderId: "1051904277079",
            appId: "1:1051904277079:web:8166b47b1a1407e2fe0112"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        function renderDashboard() {
            onValue(ref(db, 'apps'), (snapshot) => {
                const pendingDiv = document.getElementById('pending-list');
                const liveDiv = document.getElementById('live-list');
                
                pendingDiv.innerHTML = "";
                liveDiv.innerHTML = "";
                
                const data = snapshot.val();
                if (!data) {
                    pendingDiv.innerHTML = "<p>No apps pending.</p>";
                    liveDiv.innerHTML = "<p>No apps live.</p>";
                    return;
                }

                let pCount = 0;
                let lCount = 0;

                Object.keys(data).forEach(id => {
                    const item = data[id];
                    const card = document.createElement('div');
                    card.className = 'card';
                    
                    const content = `
                        <div class="info">
                            <span class="status-tag ${item.isConfirmed ? 'tag-live' : 'tag-pending'}">
                                ${item.isConfirmed ? 'Live' : 'Needs Approval'}
                            </span>
                            <strong>${item.name}</strong>
                            <small>${item.downloadUrl}</small>
                        </div>
                        <div class="btns">
                            ${!item.isConfirmed ? `<button class="btn-approve" onclick="approveApp('${id}')">Approve</button>` : ''}
                            <button class="btn-delete" onclick="deleteApp('${id}')">Delete</button>
                        </div>
                    `;
                    card.innerHTML = content;

                    if (item.isConfirmed) {
                        liveDiv.appendChild(card);
                        lCount++;
                    } else {
                        pendingDiv.appendChild(card);
                        pCount++;
                    }
                });

                if (pCount === 0) pendingDiv.innerHTML = "<p>✅ All caught up!</p>";
                if (lCount === 0) liveDiv.innerHTML = "<p>No live apps yet.</p>";
            });
        }

        // Global functions
        window.approveApp = (id) => {
            update(ref(db, 'apps/' + id), { isConfirmed: true });
        };

        window.deleteApp = (id) => {
            if (confirm("Permanently remove this app?")) {
                remove(ref(db, 'apps/' + id));
            }
        };

        renderDashboard();
    </script>
</body>
</html>
