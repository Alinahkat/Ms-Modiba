<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Admin Dashboard | Manage Submissions</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: #f4f7f6; padding: 40px; }
        #login-box { max-width: 350px; margin: 100px auto; background: white; padding: 30px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); }
        input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; }
        #dashboard { display: none; }
        
        .pending-item { 
            background: white; padding: 20px; border-radius: 15px; 
            margin-bottom: 10px; display: flex; justify-content: space-between; 
            align-items: center; border: 1px solid #eee; 
            animation: fadeIn 0.5s ease;
        }

        .actions { display: flex; gap: 10px; }
        
        .btn { border: none; padding: 10px 18px; border-radius: 8px; cursor: pointer; font-weight: 600; transition: 0.2s; }
        .approve-btn { background: #10b981; color: white; }
        .approve-btn:hover { background: #059669; }
        
        .reject-btn { background: #fee2e2; color: #ef4444; }
        .reject-btn:hover { background: #fecaca; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <div id="login-box">
        <h2>Admin Access</h2>
        <input type="email" id="email" placeholder="Email">
        <input type="password" id="password" placeholder="Password">
        <button id="login-btn" style="width:100%; padding:12px; background:#000; color:#fff; border:none; border-radius:8px; cursor:pointer;">Login</button>
    </div>

    <div id="dashboard">
        <div style="display:flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
            <h1>Review Submissions</h1>
            <button onclick="location.href='index.html'" style="background:none; border:1px solid #ddd; padding:8px 15px; border-radius:8px; cursor:pointer;">View Store</button>
        </div>
        <div id="list">Loading...</div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, onValue, update, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
        import { getAuth, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        // --- CONFIG ---
        const firebaseConfig = {
            apiKey: "AIzaSyD_lFs83fyT6pNcNECGueOYJeedGVKY7GA",
            authDomain: "homieclothing-da3f7.firebaseapp.com",
            databaseURL: "https://homieclothing-da3f7-default-rtdb.firebaseio.com",
            projectId: "homieclothing-da3f7",
            storageBucket: "homieclothing-da3f7.appspot.com",
            messagingSenderId: "1051904277079",
            appId: "1:1051904277079:web:8166b47b1a1407e2fe0112"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const auth = getAuth(app);

        // --- AUTH ---
        document.getElementById('login-btn').onclick = () => {
            const e = document.getElementById('email').value;
            const p = document.getElementById('password').value;
            signInWithEmailAndPassword(auth, e, p).catch(err => alert("Login Failed: " + err.message));
        };

        onAuthStateChanged(auth, (user) => {
            if(user) {
                document.getElementById('login-box').style.display = 'none';
                document.getElementById('dashboard').style.display = 'block';
                fetchPending();
            }
        });

        // --- CORE LOGIC ---
        function fetchPending() {
            onValue(ref(db, 'apps'), (snapshot) => {
                const list = document.getElementById('list');
                list.innerHTML = "";
                const data = snapshot.val();
                
                if(!data) { list.innerHTML = "No apps in database."; return; }

                let count = 0;
                Object.keys(data).forEach(id => {
                    // Only show apps that are NOT confirmed
                    if(data[id].isConfirmed === false) {
                        count++;
                        const div = document.createElement('div');
                        div.className = 'pending-item';
                        div.innerHTML = `
                            <div>
                                <strong>${data[id].name}</strong><br>
                                <small style="color: #666;">URL: ${data[id].downloadUrl}</small>
                            </div>
                            <div class="actions">
                                <button class="btn reject-btn" onclick="rejectApp('${id}')">Reject</button>
                                <button class="btn approve-btn" onclick="approveApp('${id}')">Approve</button>
                            </div>
                        `;
                        list.appendChild(div);
                    }
                });

                if(count === 0) list.innerHTML = "âœ¨ All caught up! No pending apps.";
            });
        }

        // --- ACTIONS ---
        window.approveApp = (id) => {
            if(confirm("Publish this app to the store?")) {
                update(ref(db, 'apps/' + id), { isConfirmed: true })
                .then(() => console.log("Approved"))
                .catch(err => alert(err.message));
            }
        };

        window.rejectApp = (id) => {
            if(confirm("Are you sure you want to delete this submission? This cannot be undone.")) {
                remove(ref(db, 'apps/' + id))
                .then(() => console.log("Deleted"))
                .catch(err => alert(err.message));
            }
        };
    </script>
</body>
</html>
