<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <title>Admin Panel | All"Apps</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #F2F2F7; }
        .glass { background: rgba(255, 255, 255, 0.7); backdrop-filter: blur(15px); }
    </style>
</head>
<body class="p-6 md:p-12">

    <div class="max-w-6xl mx-auto">
        <div class="flex flex-col md:flex-row md:items-center justify-between mb-10 gap-4">
            <div>
                <h1 class="text-4xl font-black tracking-tight text-gray-900">Admin Control</h1>
                <p class="text-gray-500 font-medium">Review and manage app submissions</p>
            </div>
            <a href="index.html" class="inline-flex items-center space-x-2 bg-black text-white px-6 py-3 rounded-2xl font-bold hover:bg-gray-800 transition shadow-lg">
                <i class="fa-solid fa-arrow-left"></i> <span>Back to Store</span>
            </a>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-12">
            <div class="bg-white p-8 rounded-[2.5rem] shadow-sm border border-gray-100">
                <p class="text-xs font-bold text-orange-500 uppercase tracking-widest mb-1">Queue</p>
                <h2 class="text-3xl font-black" id="pending-count">0</h2>
                <p class="text-gray-400 text-sm">Pending Approval</p>
            </div>
            <div class="bg-white p-8 rounded-[2.5rem] shadow-sm border border-gray-100">
                <p class="text-xs font-bold text-green-500 uppercase tracking-widest mb-1">Published</p>
                <h2 class="text-3xl font-black" id="live-count">0</h2>
                <p class="text-gray-400 text-sm">Live on Store</p>
            </div>
        </div>

        <h2 class="text-2xl font-black mb-6 px-2">Pending Submissions</h2>
        <div id="pending-grid" class="grid grid-cols-1 gap-4 mb-12">
            <div class="text-center py-20 bg-gray-100 rounded-[2rem] border-2 border-dashed border-gray-200 text-gray-400">
                Fetching data...
            </div>
        </div>

        <h2 class="text-2xl font-black mb-6 px-2">Published Apps</h2>
        <div id="live-grid" class="grid grid-cols-1 gap-4">
            </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, onValue, update, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyD_lFs83fyT6pNcNECGueOYJeedGVKY7GA",
            authDomain: "homieclothing-da3f7.firebaseapp.com",
            databaseURL: "https://homieclothing-da3f7-default-rtdb.firebaseio.com",
            projectId: "homieclothing-da3f7",
            storageBucket: "homieclothing-da3f7.appspot.com",
            messagingSenderId: "1051904277079",
            appId: "1:1051904277079:web:8166b47b1a1407e2fe0112"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        const pendingGrid = document.getElementById('pending-grid');
        const liveGrid = document.getElementById('live-grid');
        const pendingCountText = document.getElementById('pending-count');
        const liveCountText = document.getElementById('live-count');

        // Main sync function
        onValue(ref(db, 'apps'), (snapshot) => {
            const data = snapshot.val();
            pendingGrid.innerHTML = "";
            liveGrid.innerHTML = "";
            
            let pCount = 0;
            let lCount = 0;

            if (!data) {
                pendingGrid.innerHTML = "<p class='p-8 text-gray-400'>No pending requests found.</p>";
                return;
            }

            Object.keys(data).forEach(id => {
                const app = data[id];
                const card = createAdminCard(id, app);

                if (app.isConfirmed) {
                    liveGrid.appendChild(card);
                    lCount++;
                } else {
                    pendingGrid.appendChild(card);
                    pCount++;
                }
            });

            pendingCountText.innerText = pCount;
            liveCountText.innerText = lCount;
            
            if (pCount === 0) pendingGrid.innerHTML = "<div class='p-12 text-center bg-white rounded-[2rem] text-gray-400 font-bold'>âœ¨ Everything is reviewed!</div>";
        });

        function createAdminCard(id, app) {
            const div = document.createElement('div');
            div.className = "bg-white p-6 rounded-[2rem] shadow-sm flex flex-col md:flex-row items-center justify-between gap-6 border border-transparent hover:border-blue-200 transition";
            
            div.innerHTML = `
                <div class="flex items-center space-x-6 w-full md:w-auto">
                    <div class="w-16 h-16 bg-blue-50 rounded-2xl flex items-center justify-center text-blue-600 text-2xl">
                        <i class="fa-solid fa-rocket"></i>
                    </div>
                    <div>
                        <h3 class="font-extrabold text-lg">${app.name}</h3>
                        <p class="text-xs font-bold text-gray-400 uppercase tracking-widest">${app.category || 'General'}</p>
                    </div>
                </div>
                
                <div class="flex items-center space-x-3 w-full md:w-auto justify-end">
                    <button onclick="deleteApp('${id}')" class="px-5 py-2.5 rounded-xl font-bold text-sm text-red-500 hover:bg-red-50 transition">
                        Reject
                    </button>
                    ${!app.isConfirmed ? `
                        <button onclick="approveApp('${id}')" class="px-8 py-2.5 bg-blue-600 text-white rounded-xl font-bold text-sm shadow-lg shadow-blue-200 hover:bg-blue-700 transition">
                            Approve
                        </button>
                    ` : `
                        <span class="px-4 py-2 bg-green-50 text-green-600 rounded-xl font-bold text-xs uppercase tracking-widest">Active</span>
                    `}
                </div>
            `;
            return div;
        }

        // Global functions for buttons
        window.approveApp = (id) => {
            update(ref(db, `apps/${id}`), { isConfirmed: true });
        };

        window.deleteApp = (id) => {
            if (confirm("Are you sure you want to remove this app submission?")) {
                remove(ref(db, `apps/${id}`));
            }
        };
    </script>
</body>
</html>
